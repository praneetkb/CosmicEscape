<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PathMapObjectLoader.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Cosmic Escape</a> &gt; <a href="index.source.html" class="el_package">ca.sfu.cmpt276.fall2025.team14.utils</a> &gt; <span class="el_source">PathMapObjectLoader.java</span></div><h1>PathMapObjectLoader.java</h1><pre class="source lang-java linenums">package ca.sfu.cmpt276.fall2025.team14.utils;

import ca.sfu.cmpt276.fall2025.team14.model.Alien;
import ca.sfu.cmpt276.fall2025.team14.model.AlienController;
import de.gurkenlabs.litiengine.entities.IEntity;
import de.gurkenlabs.litiengine.environment.Environment;
import de.gurkenlabs.litiengine.environment.MapObjectLoader;
import de.gurkenlabs.litiengine.environment.tilemap.IMapObject;
import de.gurkenlabs.litiengine.environment.tilemap.MapUtilities;
import java.awt.geom.Path2D;
import java.awt.geom.PathIterator;
import java.awt.geom.Point2D;
import java.util.ArrayList;
import java.util.Collection;
import java.util.List;

/**
 * Loads map objects of type &quot;PATH&quot; and constructs an {@link Alien} that follows
 * the path defined by the polyline in the map object. The loader converts the
 * polyline into a {@link Path2D}, extracts all points, optionally reverses or
 * closes the path, and sets up the alien with an {@link AlienController}.
 */
public class PathMapObjectLoader extends MapObjectLoader {

    /**
     * Creates a new loader for map objects of type &quot;PATH&quot;.
     */
    public PathMapObjectLoader() {
<span class="fc" id="L29">        super(&quot;PATH&quot;);</span>
<span class="fc" id="L30">    }</span>

    /**
     * Loads an alien path from the given map object. If the object is a valid
     * &quot;alien-path&quot; polyline, the method creates a path, extracts its points,
     * determines whether it should close or reverse, initializes an {@link Alien},
     * and attaches an {@link AlienController} to handle movement along the path.
     *
     * @param environment the environment into which entities are being loaded
     * @param mapObject the map object defining the polyline path
     * @return a collection containing the created alien, or an empty collection if invalid
     */
    @Override
    public Collection&lt;IEntity&gt; load(Environment environment, IMapObject mapObject) {
        // Get path
<span class="nc" id="L45">        Collection&lt;IEntity&gt; entities = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L46" title="All 2 branches missed.">        if (!mapObject.getType().equals(&quot;PATH&quot;)</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">                || !mapObject.getName().equals(&quot;alien-path&quot;)</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">                || mapObject.getPolyline() == null</span>
<span class="nc bnc" id="L49" title="All 2 branches missed.">                || mapObject.getPolyline().getPoints().isEmpty()) {</span>
<span class="nc" id="L50">            return entities;</span>
        }
        // Convert the mapObject's polyline to a Path2D object.
<span class="nc" id="L53">        final Path2D path = MapUtilities.convertPolyshapeToPath(mapObject);</span>
<span class="nc bnc" id="L54" title="All 2 branches missed.">        if (path == null) {</span>
<span class="nc" id="L55">            return entities;</span>
        }
        // Get all points along path and reverse
<span class="nc" id="L58">        List&lt;Point2D&gt; points = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L59">        double[] arr = new double[6];</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">        for(PathIterator it = path.getPathIterator(null); !it.isDone(); it.next())</span>
        {
<span class="nc" id="L62">            it.currentSegment(arr);</span>
<span class="nc" id="L63">            points.add(new Point2D.Double(arr[0], arr[1]));</span>
        }
        // Close path if pixel distance &lt; 5
<span class="nc bnc" id="L66" title="All 2 branches missed.">        if (points.getFirst().distance(points.getLast()) &lt; 5) {</span>
<span class="nc" id="L67">            points.add(points.getFirst());</span>
        } else {
<span class="nc" id="L69">            points = points.reversed();</span>
        }
        // Get starting point
<span class="nc" id="L72">        final Point2D start = new Point2D.Double(points.getLast().getX(), points.getLast().getY());</span>
        // Initialize new alien on path
<span class="nc" id="L74">        Alien alien = new Alien();</span>
<span class="nc" id="L75">        alien.setLocation(start);</span>
<span class="nc" id="L76">        alien.setMapId(mapObject.getId());</span>
<span class="nc" id="L77">        alien.addController(new AlienController(alien, path, points));</span>
<span class="nc" id="L78">        entities.add(alien);</span>

<span class="nc" id="L80">        return entities;</span>
    }
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>